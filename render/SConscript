Import('env')
aqsisdll_sources = Split("""
	attributes.cpp
	bound.cpp
	bucket.cpp
	condition.cpp
	converter.cpp
	csgtree.cpp
	curves.cpp
	environment.cpp
	genpoly.cpp
	graphicsstate.cpp
	imagebuffer.cpp
	imagepixel.cpp
	imagers.cpp
	inlineparse.cpp
	lath.cpp
	lights.cpp
	micropolygon.cpp
	mpdump.cpp
	nurbs.cpp
	occlusion.cpp
	options.cpp
	parameters.cpp
	patch.cpp
	points.cpp
	polygon.cpp
	procedural.cpp
	quadrics.cpp
	render.cpp
	renderer.cpp
	ri.cpp
	shaders.cpp
	shadowmap.cpp
	stats.cpp
	subdivision2.cpp
	surface.cpp
	symbols.cpp
	teapot.cpp
	texturemap.cpp
	transform.cpp
	trimcurve.cpp""")


aqsisdll_headers = Split("""
	attributes.h            ilightsource.h          micropolygon.h          ri.h
	bilinear.h              imagebuffer.h           motion.h                ri_cache.h
	bound.h                 imagepixel.h            mpdump.h                rifile.h
	bucket.h                imagers.h               nurbs.h                 shadeop.h
	clippingvolume.h        inlineparse.h           objectinstance.h        shaders.h
	condition.h             iraytrace.h             occlusion.h             stats.h
	converter.h             irenderer.h             options.h               subdivision2.h
	csgtree.h               ishader.h               parameters.h            surface.h
	curves.h                ishaderdata.h           patch.h                 symbols.h
	focus.h                 ishaderexecenv.h        plane.h                 teapot.h
	forwarddiff.h           isurface.h              points.h                texturemap.h
	genpoly.h               itexturemap.h           polygon.h               transform.h
	graphicsstate.h         itransform.h            procedural.h            trimcurve.h
	iattributes.h           kdtree.h                quadrics.h              version.h
	iddmanager.h            lath.h                  render.h
	idsoshadeops.h          lights.h                renderer.h""")

aqsisdll_xml = Split("""
	api.xml""")

aqsisdll_xsl = Split("""
	apiheader.xsl		apicache.xsl		apivalidate.xsl""")	


aqsisenv = env.Copy()
aqsisenv.AppendUnique(CPPDEFINES=[('_qBUILDING', 'CORE'), ('CORE', 1)])

aqsisenv.UseTargetOptions('libaqsis')

if 'win32' == aqsisenv['PLATFORM']:
	aqsisdll_sources = aqsisdll_sources + ["libaqsis.def"]


aqsisenv.Replace(APIXML = aqsisenv.File('api.xml'))
cachegen = aqsisenv.Command('ri_cache.inl', 'apicache.xsl', ['$XSLTPROC -o $TARGET $SOURCE $APIXML'])
headergen = aqsisenv.Command('ri.inl', 'apiheader.xsl', ['$XSLTPROC -o $TARGET $SOURCE $APIXML'])
validategen = aqsisenv.Command('ri_validate.inl', 'apivalidate.xsl', ['$XSLTPROC -o $TARGET $SOURCE $APIXML'])

aqsisenv.Depends(cachegen, '$APIXML')
aqsisenv.Depends(headergen, '$APIXML')
aqsisenv.Depends(validategen, '$APIXML')

aqsisenv.AppendUnique(LIBS = ['ddmanager', 'raytrace', 'rib2', 'rib2ri', 'shaderexecenv', 'shadervm', 'aqsistypes', '$tiff_lib', '$z_lib'])
aqsisdll = aqsisenv.SharedLibrary('aqsis', aqsisdll_sources)

Depends(aqsisdll, cachegen)
Depends(aqsisdll, validategen)
Depends(aqsisdll, headergen)

Export('cachegen validategen headergen')

aqsisenv.Install('$BINDIR', aqsisdll)

#aqsisproject = aqsisenv.MSVSProject(target = 'render' + env['MSVSPROJECTSUFFIX'],
#	srcs = aqsisdll_sources,
#	buildtarget = aqsisdll,
#	variant = 'Release')

#aqsisenv.Depends(aqsisdll, aqsisproject)


env.Distribute('render', aqsisdll_sources)
env.Distribute('render', aqsisdll_headers)
env.Distribute('render', aqsisdll_xml)
env.Distribute('render', aqsisdll_xsl)
env.Distribute('render', 'SConscript')
